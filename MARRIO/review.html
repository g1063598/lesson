<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>复习超级玛丽奥-canvas行走</title>
</head>
<body>
    <canvas id="demo" width = " 800" height = "400" style="border:1px solid blue;
    margin:50px auto; display:block;"></canvas>
    <script>
        window.onload = function () {
            let canvas = document.querySelector('#demo');
            let context = canvas.getContext('2d');
            var mario = new Image();
            mario.src = 'http://static.blueidea.com/attachment/forum/201207/03/180652md4ydy2txwotdd7l.png ';
            mario.onload = function() {
                drawMario();
            }
            document.addEventListener('keydown',function (e) {
                var direction = getDirection(e);
                player.stop = false;
                playAction(direction);
                
            })
            document.addEventListener('keyup',function (e) {
                var direction = getDirection(e);
                player.stop = true;
                playAction(direction);
                
            })

            function playAction(direction) {
                playMove(direction);
            }

            function playMove(direction) {
                context.clearRect(0,0,canvas.width,canvas.height)
                if(player.stop){
                    player.imageX = 0;
                }else {
                    player.imageX +=50;
                }
                if(player.imageX >= 150){
                    player.imageX = 0;
                }
                if(direction === "right"){
                    player.x += 5;
                    player.imageY = 0;
                } else if (direction === "left") {
                    player.x -= 5;
                    player.imageY = 60;
                }
                drawMario();
            }

            function getDirection (e) {
                var direction;
                var keyCode = e.keyCode;
                switch(keyCode) {
                    case 37:direction = "left";break;
                    case 38:direction = "up";break;
                    case 39:direction = "right";break;
                    case 40:direction = "down";break;
                }
                return direction;

            }
            var player = {
                width: 50,
                height: 60,
                x: 50,
                y: 0,
                imageX: 0,
                imageY: 0,
                stop:true
              }
            function drawMario() {
                context.drawImage(mario, player.imageX,player.imageY,
                player.width,player.height,player.x,
                canvas.height-player.height,player.width,
                 player.height);
            }
        }
    </script>
</body>
</html>